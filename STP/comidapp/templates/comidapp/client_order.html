{% extends 'template.html' %}

{% block title %}Pedido Confirmado{% endblock %}

{% block content %}
<div class="container text-center">
    <h2><strong>PEDIDO REALIZADO CON ÉXITO</strong></h2>
    <p>Estamos cocinando su orden...</p>
    <p>ID del pedido: <strong>{{ pedido.id }}</strong></p>
    <img src="https://media.tenor.com/pJaEbhfzhAUAAAAj/club-penguiin-pizza.gif" alt="Cocinando" width="150">

    {% for item in platos_con_cantidad %}
    <div class="card my-3">
        <div class="row g-0 align-items-center">
            <div class="col-3 d-flex align-items-center justify-content-center">
                <h6 class="text-muted">Sin imagen</h6>
            </div>

            <div class="col-6">
                <div class="card-body text-start">
                    <h5 class="card-title">{{ item.plato.name }}</h5>
                    <p class="card-text">Precio unitario: ${{ item.plato.precio }}</p>
                    <p class="card-text">Cantidad: {{ item.cantidad }}</p>
                </div>
            </div>

            <div class="col-3 d-flex justify-content-center">
                <button class="btn btn-primary" type="button"
                        data-bs-toggle="collapse"
                        data-bs-target="#resena-form-{{ item.plato.id }}"
                        aria-expanded="false"
                        aria-controls="resena-form-{{ item.plato.id }}">
                    Reseñar
                </button>
            </div>
        </div>

        <!-- Collapse dentro de la misma card -->
        <div class="collapse collapse-horizontal" id="resena-form-{{ item.plato.id }}">
            <div class="card-body border-top text-start" style="width: 100%;">
                <h6>Deja tu reseña para {{ item.plato.name }}</h6>
                <form method="POST" action="{% url 'client_order' %}">
                    {% csrf_token %}
                    <input type="hidden" name="plato_id" value="{{ item.plato.id }}">
                    <div class="mb-2">
                        {{ form.texto.label_tag }}
                        {{ form.texto }}
                    </div>
                    <div class="mb-3">
                        {{ form.puntuacion.label_tag }}
                        {{ form.puntuacion }}
                    </div>
                    <button type="submit" class="btn btn-sm btn-success">Enviar Reseña</button>
                </form>
            </div>
        </div>
    </div>
    {% endfor %}

    <h3 class="text-end mt-4">
        Total del pedido  |  ${{ total_pedido }}
    </h3>
</div>
{% endblock %}
